<?xml version="1.0" encoding="utf-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.2.7 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC4648 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4648.xml">
<!ENTITY RFC7231 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7231.xml">
<!ENTITY W3C.CR-payment-request-20170921 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml4/reference.W3C.CR-payment-request-20170921.xml">
<!ENTITY W3C.CR-payment-method-id-20170914 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml4/reference.W3C.CR-payment-method-id-20170914.xml">
]>

<?rfc toc="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc comments="yes"?>

<rfc docName="draft-hope-bailie-http-payments-00" category="std">

  <front>
    <title>HTTP-Payments</title>

    <author initials="A." surname="Hope-Bailie" fullname="Adrian Hope-Bailie">
      <organization>Ripple</organization>
      <address>
        <postal>
          <street>315 Montgomery Street</street>
          <city>San Francisco</city>
          <region>CA</region>
          <code>94104</code>
          <country>US</country>
        </postal>
        <phone>-----------------</phone>
        <email>adrian@ripple.com</email>
        <uri>https://www.ripple.com</uri>
      </address>
    </author>

    <date year="2017" month="November" day="03"/>

    <area>dispatch</area>
    
    

    <abstract>


<t>HTTP-Payments describes a mechanism for passing a standardized payment request in the headers of an HTTP 402 response and the expected behaviour of HTTP clients that receive such a response.</t>



    </abstract>


    <note title="Feedback">


<t>This specification is an early experiment in bringing the work of the W3C Web Payments working group to the HTTP protocol. It is maintained at <eref target="https://github.com/adrianhopebailie/http-payments">https://github.com/adrianhopebailie/http-payments</eref>.</t>

<t>The work is inspired by work in the Interledger community on <xref target="HTTP-ILP"></xref></t>


    </note>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>The W3C Web Payments working group has defined a Web Platform API that is being widely deployed to browsers for requesting a payment. The <xref target="W3C.CR-payment-request-20170921">PaymentRequest API</xref>, defines an interface for a website to pass a payment request to the user agent via this API.</t>

<t>The user agent will then, through interaction with the user, complete or reject the requested payment.</t>

<t>HTTP-Payments describes a manner in which an HTTP server can request payment from a client in the same manner as a website would from a user agent using the W3C APIs.</t>

<t>The critical portion of the payment request is the set of, one or more, supported payment methods and associated payment-method-specific data. HTTP-Payments defines a mechaism by which these are expressed in the response headers of an HTTP request for which the server requires a payment.</t>

<t>In the website and user-agent scenario, when handling the payment request, the user-agent will prompt the user to pick one of the supported payment methods and will then handle the payment in a manner that is appropriate for that payment method. In an HTTP-Payment, the HTTP client will perform this function, likely with no user interaction.</t>

</section>
<section anchor="terminology" title="Terminology">

<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC2119][].</t>

</section>
<section anchor="payment-methods" title="Payment Methods">

<t>A payment method is a way that the payee can be paid. Examples include, via credit card, bank wire transfer, or Bitcoin.</t>

<t>A payment method is identified by a payment method identifier as specified in the <xref target="W3C.CR-payment-method-id-20170914">Payment Method Identifiers specification</xref>. This is either a standardized short-string, identified in a registry maintained by the W3C Web Payments WG, or a URL.</t>

<t>The most common case will be for the URL form to be used. In cases where there is no authority responsible for the payment method that can host the payment method URL, the WG will consider adding a new identifier for the payment method to the registry.</t>

<t>Payment methods define the data that the payer and payee need to exchange, to complete a payment, and the process by which this occurs.</t>

</section>
<section anchor="http-status-code-402" title="HTTP Status Code 402">

<t>The HTTP Status Code, 402 (Payment Required) is currently defined in <xref target="RFC7231"></xref> as "reserved for future use". Using HTTP-Payment a service MAY respond to any request with the 402 response code and use the "Pay" header to specify the payment request details.</t>

<section anchor="the-pay-header" title="The &quot;Pay&quot; Header">

<t>The body of the "Pay" header is defined as follows:</t>

<figure><artwork><![CDATA[
Pay = 1#( payment-method-identifier RWS payment-amount RWS payment-address RWS payment-method-data )

payment-method-identifier = token
payment-amount = 1*DIGIT
payment-address = token
payment-method-data -token

;token is defined in [RFC7231](#RFC7231)
]]></artwork></figure>

<t>The Pay field-value consists of a comma-separated list of payment requests for payment using different payment methods accepted by the sender.</t>

<t>The fields in the header are:</t>

<t><list style="symbols">
  <t>payment-method-identifier:
The payment method identifier for the accepted payment method. Either a standardized short-string or a URL.</t>
  <t>payment-amount:
The amount that must be paid, expressed as an integer. The currency, scale and precision of the destination account are expected to be expressed in the account address or interprted from the payment mthod data.</t>
  <t>payment-address:
A payment-method specific payee address. For example, if the payment method is Bitcoin this would be a Bitcoin address.</t>
  <t>payment-method-data:
Payment method specific data. This is either a URI identifying the data or, if it is small enough, is the data itself, BASE64URL encoded as described in <xref target="RFC4648"></xref>, Section 5.</t>
</list></t>

</section>
<section anchor="the-pay-token-header" title="The &quot;Pay-Token&quot; Header">

<t>An HTTP client that makes a paid-HTTP request, after paying for the request to be processed, MAY attach a "Pay-Token" header with a token referencing the payment.</t>

<t>This mechanism can be employed by services wishing to accept payments without binding these to an HTTP session.</t>

<figure><artwork><![CDATA[
Pay-Token = token
]]></artwork></figure>

</section>
<section anchor="the-pay-balance-header" title="The &quot;Pay-Balance&quot; Header">

<t>Ann HTTP Service that accepts payments may respond to any request with a "Pay-Balance" header. This contains an integer indicating the current balance of paid credit the client has with the HTTP service.</t>

<figure><artwork><![CDATA[
Pay-Balance = 1*DIGIT
]]></artwork></figure>

</section>
<section anchor="flow" title="Flow">

<t>Upon receipt of a 402 response, an HTTP client MUST look for any "Pay" headers and parse these. The client can discard all headers for which it is not equipped to make a payment (i.e. filter on payment-method-identifier)</t>

<t>The client MUST then select the header that is preferred for processing based upon external interactions (such as with a human user) or pre-configured rules. The client MUST attempt to make a payment using the payment method identified in the header, for the amount specified, and to the destination address specified.</t>

<t>The payment-method specific data SHOULD be sufficient for the system processing the payment to reconcile the payment with the original HTTP request.</t>

<t>The client SHOULD receive a token in return for completeing the payment. If the payment method used does return a token to the payer, it MUST pass this token in subsequent HTTP requests.</t>

<t>The token MUST be passed in the "Pay-Token" header, BASE64URL encoded as described in <xref target="RFC4648"></xref>, Section 5.</t>

<t>The HTTP service MUST process the "Pay-Token" header and use this to reconcile this HTTP request with the payment received prior.</t>

</section>
<section anchor="example" title="Example">

<t>Client requests access to a paid resource:</t>

<figure><artwork><![CDATA[
POST /upload HTTP/1.1
Host: myservice.example
]]></artwork></figure>

<t>Server responds with payment request (and optionally indicates that the client has a zero balance):</t>

<figure><artwork><![CDATA[
HTTP/1.1 402 Payment Required
Pay: http://interledger.org 10 us.nexus.ankita.~recv.filepay SkTcFTZCBKgP6A6QOUVcwWCCgYIP4rJPHlIzreavHdU
Pay-Balance: 0
]]></artwork></figure>

<t>Client makes the payment through an appropriate payment side-channel and then attempts the request again:</t>

<figure><artwork><![CDATA[
POST /upload HTTP/1.1
Host: myservice.example
Pay-Token: 7y0SfeN7lCuq0GFF5UsMYZofIjJ7LrvPvsePVWSv450
]]></artwork></figure>

<t>Server responds:</t>

<figure><artwork><![CDATA[
HTTP/1.1 200 Success
Pay-Balance: 0  
]]></artwork></figure>

</section>
</section>


  </middle>

  <back>

    <references title='Normative References'>

&RFC4648;
&RFC7231;
&W3C.CR-payment-request-20170921;
&W3C.CR-payment-method-id-20170914;


    </references>

    <references title='Informative References'>

<reference anchor="HTTP-ILP" target="https://github.com/interledger/rfcs/blob/master/0014-http-ilp/0014-http-ilp.md">
  <front>
    <title>HTTP-ILP</title>
    <author >
      <organization>Interledger Community Group</organization>
    </author>
    <date year="2017" month="October"/>
  </front>
</reference>


    </references>


<section anchor="security-considerations" title="Security Considerations">

<t>Payment information MUST not be exchanged on a connection that is not secured end-to-end. Servers that receive any HTTP payment header over an insecure connection should reject the request. Clients that receive any HTTP Payment headers over an insecure connection MUST ignore the headers.</t>

</section>
<section anchor="iana-considerations" title="IANA Considerations">

<section anchor="header-field-registration" title="Header Field Registration">

<t>HTTP header fields are registered within the "Message Headers"
   registry maintained at
   <eref target="http://www.iana.org/assignments/message-headers/">http://www.iana.org/assignments/message-headers/</eref>.</t>

<t>This document defines the following new HTTP header fields.</t>

<texttable>
      <ttcol align='left'>Header Field Name</ttcol>
      <ttcol align='left'>Protocol</ttcol>
      <ttcol align='left'>Status</ttcol>
      <ttcol align='left'>Reference</ttcol>
      <c>Pay</c>
      <c>http</c>
      <c>?</c>
      <c>This Document</c>
      <c>Pay-Token</c>
      <c>http</c>
      <c>?</c>
      <c>This Document</c>
      <c>Pay-Balance</c>
      <c>http</c>
      <c>?</c>
      <c>This Document</c>
</texttable>

<t>The change controller is: "IETF (iesg@ietf.org) - Internet
   Engineering Task Force".</t>

</section>
<section anchor="payment-method-identifier-short-string-registry" title="Payment Method Identifier Short-string Registry">

<t>The W3C maintains a registry of standardized short-string payment method identifiers as part of the <xref target="W3C.CR-payment-method-id-20170914">Payment Method Identifier</xref> specification. If standardized short-string identifiers are to be used for HTTP-Payments this may be better served as an IANA registry.</t>

</section>
</section>


  </back>

<!-- ##markdown-source:
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
iV+Btv0KUoXMSG7/sHfIHzugIxyK5SqynooixvGUilg6BOZm57CPWzQlwgSM
tIo0rNy6rWvwrBSflDWRlA+CblEdIs7NjityMH9hGfabX1V6xs7F4QAg7hXq
I/yWxb2GIuQ/AN1DDwgOauiVGN9P0rPJryev/z2/fnn88qer25/Tx7uTk/kv
o+sj++P1eT76ZJV8OM9uNwl/KAY11FwNtOIvHOECTzUPueJrbJ8TTNaFymOL
WkSKcq2KQc4hnf1lS7XS9FC8Wg3GM/XuVX5S/TF4e3b24tZd/vKrmY1+//HV
hX24fnDq+ue78cPRi8GWkTct8nwwEOOKfGsHNkLw1wH+hPQM46WiE4mTcHhA
vOjWRwD1lzYTohczFZXQ3OFnmI6wAwLMOPRiYsGBDpeHMdC6QO+VwJ+eYP03
vmFgVuWPTEFuCEfzQDGJ33loqaYgaDuwFN4+Z++Jk13fSWoZ1y0Z7otCaM96
Xhg+y4lz6GxidPzueAs4CHkurMQZ9mgQFXSsIvnrS7BU3F5o47BF4eMXhWhh
2EZqvAQ7yrkKazr6irnrXEvSh+J/hIjDL7RaFhLDrY8fqeYFFXH9JS+XhG30
/8kl06R1rhlP1VEBPh3ALIKHSdu68/zP7T2/wy8Pn8V1+GAIl+GcBkfehGpZ
0XfOzzR964t0knz+2iXfs3Rsz9s/n4l8wuW/1k9pp2/iTtfTQ8X8l6fHevPP
TWfsweEolqhKtgA4ndEMxd7odHIGtZ9y8x+08jO05oFI+ONmwf9rwCl+1lWK
Wu+JdPfYUkL1zbnnybNYMW627MFFV+uPg9GxXPMUFSrlp9v+Jw8VHCZuKI99
7NGfPiH+n46E26fIVM88rVVLjfq0noodLJLaH5MowWOXA0OmymOpHQ4C+TiC
wn19SvpfV/b0pbgiAAA=

-->

</rfc>

