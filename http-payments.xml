<?xml version="1.0" encoding="utf-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.2.7 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC4648 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4648.xml">
<!ENTITY RFC7231 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7231.xml">
<!ENTITY W3C.CR-payment-request-20170921 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml4/reference.W3C.CR-payment-request-20170921.xml">
<!ENTITY W3C.CR-payment-method-id-20170914 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml4/reference.W3C.CR-payment-method-id-20170914.xml">
]>

<?rfc toc="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc comments="yes"?>

<rfc docName="draft-hope-bailie-http-payments-01" category="std">

  <front>
    <title>HTTP-Payments</title>

    <author initials="A." surname="Hope-Bailie" fullname="Adrian Hope-Bailie">
      <organization>Ripple</organization>
      <address>
        <postal>
          <street>315 Montgomery Street</street>
          <city>San Francisco</city>
          <region>CA</region>
          <code>94104</code>
          <country>US</country>
        </postal>
        <phone>-----------------</phone>
        <email>adrian@ripple.com</email>
        <uri>https://www.ripple.com</uri>
      </address>
    </author>

    <date year="2017" month="November" day="03"/>

    <area>dispatch</area>
    
    

    <abstract>


<t>HTTP-Payments describes a mechanism for passing a standardized payment request in the headers of an HTTP 402 response and the expected behaviour of HTTP clients that receive such a response.</t>



    </abstract>


    <note title="Feedback">


<t>This specification is an early experiment in bringing the work of the W3C Web Payments working group to the HTTP protocol. It is maintained at <eref target="https://github.com/adrianhopebailie/http-payments">https://github.com/adrianhopebailie/http-payments</eref>.</t>

<t>The work is inspired by work in the Interledger community on <xref target="HTTP-ILP"></xref></t>


    </note>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>The W3C Web Payments working group has defined a Web Platform API that is being widely deployed to browsers for requesting a payment. The <xref target="W3C.CR-payment-request-20170921">PaymentRequest API</xref>, defines an interface for a website to pass a payment request to the user agent via this API.</t>

<t>The user agent will then, through interaction with the user, complete or reject the requested payment.</t>

<t>HTTP-Payments describes a manner in which an HTTP server can request payment from a client in the same manner as a website would from a user agent using the W3C APIs.</t>

<t>The critical portion of the payment request is the set of, one or more, supported payment methods and associated payment-method-specific data. HTTP-Payments defines a mechaism by which these are expressed in the response headers of an HTTP request for which the server requires a payment.</t>

<t>In the website and user-agent scenario, when handling the payment request, the user-agent will prompt the user to pick one of the supported payment methods and will then handle the payment in a manner that is appropriate for that payment method. In an HTTP-Payment, the HTTP client will perform this function, likely with no user interaction.</t>

</section>
<section anchor="terminology" title="Terminology">

<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC2119][].</t>

</section>
<section anchor="payment-methods" title="Payment Methods">

<t>A payment method is a way that the payee can be paid. Examples include, via credit card, bank wire transfer, or Bitcoin.</t>

<t>A payment method is identified by a payment method identifier as specified in the <xref target="W3C.CR-payment-method-id-20170914">Payment Method Identifiers specification</xref>. This is either a standardized short-string, identified in a registry maintained by the W3C Web Payments WG, or a URL.</t>

<t>The most common case will be for the URL form to be used. In cases where there is no authority responsible for the payment method that can host the payment method URL, the WG will consider adding a new identifier for the payment method to the registry.</t>

<t>Payment methods define the data that the payer and payee need to exchange, to complete a payment, and the process by which this occurs.</t>

</section>
<section anchor="http-status-code-402" title="HTTP Status Code 402">

<t>The HTTP Status Code, 402 (Payment Required) is currently defined in <xref target="RFC7231"></xref> as "reserved for future use". Using HTTP-Payment a service MAY respond to any request with the 402 response code and use the "Pay" header to specify the payment request details.</t>

<section anchor="the-pay-header" title="The &quot;Pay&quot; Header">

<t>The body of the "Pay" header is defined as follows:</t>

<figure><artwork><![CDATA[
Pay = 1#( payment-method-identifier RWS payment-amount RWS payment-address RWS payment-method-data )

payment-method-identifier = token
payment-amount = 1*DIGIT
payment-address = token
payment-method-data -token

;token is defined in [RFC7231](#RFC7231)
]]></artwork></figure>

<t>The Pay field-value consists of a comma-separated list of payment requests for payment using different payment methods accepted by the sender.</t>

<t>The fields in the header are:</t>

<t><list style="symbols">
  <t>payment-method-identifier:
The payment method identifier for the accepted payment method. Either a standardized short-string or a URL.</t>
  <t>payment-amount:
The amount that must be paid, expressed as an integer. The currency, scale and precision of the destination account are expected to be expressed in the account address or interprted from the payment mthod data.</t>
  <t>payment-address:
A payment-method specific payee address. For example, if the payment method is Bitcoin this would be a Bitcoin address.</t>
  <t>payment-method-data:
Payment method specific data. This is either a URI identifying the data or, if it is small enough, is the data itself, BASE64URL encoded as described in <xref target="RFC4648"></xref>, Section 5.</t>
</list></t>

</section>
<section anchor="the-pay-token-header" title="The &quot;Pay-Token&quot; Header">

<t>An HTTP client that makes a paid-HTTP request, after paying for the request to be processed, MAY attach a "Pay-Token" header with a token referencing the payment.</t>

<t>This mechanism can be employed by services wishing to accept payments without binding these to an HTTP session.</t>

<figure><artwork><![CDATA[
Pay-Token = token
]]></artwork></figure>

</section>
<section anchor="the-pay-balance-header" title="The &quot;Pay-Balance&quot; Header">

<t>Ann HTTP Service that accepts payments may respond to any request with a "Pay-Balance" header. This contains an integer indicating the current balance of paid credit the client has with the HTTP service.</t>

<figure><artwork><![CDATA[
Pay-Balance = 1*DIGIT
]]></artwork></figure>

</section>
<section anchor="flow" title="Flow">

<t>Upon receipt of a 402 response, an HTTP client MUST look for any "Pay" headers and parse these. The client can discard all headers for which it is not equipped to make a payment (i.e. filter on payment-method-identifier)</t>

<t>The client MUST then select the header that is preferred for processing based upon external interactions (such as with a human user) or pre-configured rules. The client MUST attempt to make a payment using the payment method identified in the header, for the amount specified, and to the destination address specified.</t>

<t>The payment-method specific data SHOULD be sufficient for the system processing the payment to reconcile the payment with the original HTTP request.</t>

<t>The client SHOULD receive a token in return for completeing the payment. If the payment method used does return a token to the payer, it MUST pass this token in subsequent HTTP requests.</t>

<t>The token MUST be passed in the "Pay-Token" header, BASE64URL encoded as described in <xref target="RFC4648"></xref>, Section 5.</t>

<t>The HTTP service MUST process the "Pay-Token" header and use this to reconcile this HTTP request with the payment received prior.</t>

</section>
<section anchor="example" title="Example">

<t>Client requests access to a paid resource:</t>

<figure><artwork><![CDATA[
POST /upload HTTP/1.1
Host: myservice.example
]]></artwork></figure>

<t>Server responds with payment request (and optionally indicates that the client has a zero balance):</t>

<figure><artwork><![CDATA[
HTTP/1.1 402 Payment Required
Pay: http://interledger.org 10 us.nexus.ankita.~recv.filepay SkTcFTZCBKgP6A6QOUVcwWCCgYIP4rJPHlIzreavHdU
Pay-Balance: 0
]]></artwork></figure>

<t>Client makes the payment through an appropriate payment side-channel and then attempts the request again:</t>

<figure><artwork><![CDATA[
POST /upload HTTP/1.1
Host: myservice.example
Pay-Token: 7y0SfeN7lCuq0GFF5UsMYZofIjJ7LrvPvsePVWSv450
]]></artwork></figure>

<t>Server responds:</t>

<figure><artwork><![CDATA[
HTTP/1.1 200 Success
Pay-Balance: 0  
]]></artwork></figure>

</section>
</section>


  </middle>

  <back>

    <references title='Normative References'>

&RFC4648;
&RFC7231;
&W3C.CR-payment-request-20170921;
&W3C.CR-payment-method-id-20170914;


    </references>

    <references title='Informative References'>

<reference anchor="HTTP-ILP" target="https://github.com/interledger/rfcs/blob/master/0014-http-ilp/0014-http-ilp.md">
  <front>
    <title>HTTP-ILP</title>
    <author >
      <organization>Interledger Community Group</organization>
    </author>
    <date year="2017" month="October"/>
  </front>
</reference>


    </references>


<section anchor="security-considerations" title="Security Considerations">

<t>Payment information MUST not be exchanged on a connection that is not secured end-to-end. Servers that receive any HTTP payment header over an insecure connection should reject the request. Clients that receive any HTTP Payment headers over an insecure connection MUST ignore the headers.</t>

</section>
<section anchor="iana-considerations" title="IANA Considerations">

<section anchor="header-field-registration" title="Header Field Registration">

<t>HTTP header fields are registered within the "Message Headers"
   registry maintained at
   <eref target="http://www.iana.org/assignments/message-headers/">http://www.iana.org/assignments/message-headers/</eref>.</t>

<t>This document defines the following new HTTP header fields.</t>

<texttable>
      <ttcol align='left'>Header Field Name</ttcol>
      <ttcol align='left'>Protocol</ttcol>
      <ttcol align='left'>Status</ttcol>
      <ttcol align='left'>Reference</ttcol>
      <c>Pay</c>
      <c>http</c>
      <c>?</c>
      <c>This Document</c>
      <c>Pay-Token</c>
      <c>http</c>
      <c>?</c>
      <c>This Document</c>
      <c>Pay-Balance</c>
      <c>http</c>
      <c>?</c>
      <c>This Document</c>
</texttable>

<t>The change controller is: "IETF (iesg@ietf.org) - Internet
   Engineering Task Force".</t>

</section>
<section anchor="payment-method-identifier-short-string-registry" title="Payment Method Identifier Short-string Registry">

<t>The W3C maintains a registry of standardized short-string payment method identifiers as part of the <xref target="W3C.CR-payment-method-id-20170914">Payment Method Identifier</xref> specification. If standardized short-string identifiers are to be used for HTTP-Payments this may be better served as an IANA registry.</t>

</section>
</section>


  </back>

<!-- ##markdown-source:
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
wn19SvpfjvTirbgiAAA=

-->

</rfc>

