<?xml version="1.0" encoding="utf-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.2.7 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC4648 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4648.xml">
<!ENTITY RFC7231 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7231.xml">
<!ENTITY W3C.CR-payment-request-20170921 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml4/reference.W3C.CR-payment-request-20170921.xml">
<!ENTITY W3C.CR-payment-method-id-20170914 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml4/reference.W3C.CR-payment-method-id-20170914.xml">
]>

<?rfc toc="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc comments="yes"?>

<rfc docName="draft-hope-bailie-http-payments-00" category="std">

  <front>
    <title>HTTP-Payments</title>

    <author initials="A." surname="Hope-Bailie" fullname="Adrian Hope-Bailie">
      <organization>Ripple</organization>
      <address>
        <postal>
          <street>315 Montgomery Street</street>
          <city>San Francisco</city>
          <region>CA</region>
          <code>94104</code>
          <country>US</country>
        </postal>
        <phone>-----------------</phone>
        <email>adrian@ripple.com</email>
        <uri>https://www.ripple.com</uri>
      </address>
    </author>

    <date year="2017" month="October" day="31"/>

    <area>dispatch</area>
    
    

    <abstract>


<t>HTTP-Payments describes a mechanism for passing a standardized payment request in the headers of an HTTP 402 response and the expected behaviour of HTTP clients that receive such a response.</t>



    </abstract>


    <note title="Feedback">


<t>This specification is an early experiment in bringing the work of the W3C Web Payments working group to the HTTP protocol. It is maintained at <eref target="https://github.com/adrianhopebailie/http-payments">https://github.com/adrianhopebailie/http-payments</eref>.</t>

<t>The work is inspired by work in the Interledger community on <xref target="HTTP-ILP"></xref></t>


    </note>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>The W3C Web Payments working group has defined a Web Platform API that is being widely deployed to browsers for requesting a payment. The <xref target="W3C.CR-payment-request-20170921">PaymentRequest API</xref>, defines an interface for a website to pass a payment request to the user agent via this API.</t>

<t>The user agent will then, through interaction with the user, complete or reject the requested payment.</t>

<t>HTTP-Payments describes a manner in which an HTTP server can request payment from a client in the same manner as a website would from a user agent using the W3C APIs.</t>

<t>The critical portion of the payment request is the set of, one or more, supported payment methods and associated payment-method-specific data. HTTP-Payments defines a mechaism by which these are expressed in the response headers of an HTTP request for which the server requires a payment.</t>

<t>In the website and user-agent scenario, when handling the payment request, the user-agent will prompt the user to pick one of the supported payment methods and will then handle the payment in a manner that is appropriate for that payment method. In an HTTP-Payment, the HTTP client will perform this function, likely with no user interaction.</t>

</section>
<section anchor="terminology" title="Terminology">

<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC2119][].</t>

</section>
<section anchor="payment-methods" title="Payment Methods">

<t>A payment method is a way that the payee can be paid. Examples include, via credit card, bank wire transfer, or Bitcoin.</t>

<t>A payment method is identified by a payment method identifier as specified in the <eref target="W3C.CR-payment-method-id-20170914">Payment Method Identifiers specification</eref>. This is either a standardized short-string, identified in a registry maintained by the W3C Web Payments WG, or a URL.</t>

<t>The most common case will be for the URL form to be used. In cases where there is no authority responsible for the payment method that can host the payment method URL, the WG will consider adding a new identifier for the payment method to the registry.</t>

<t>Payment methods define the data that the payer and payee need to exchange, to complete a payment, and the process by which this occurs.</t>

</section>
<section anchor="http-status-code-402" title="HTTP Status Code 402">

<t>The HTTP Status Code, 402 (Payment Required) is currently defined in <xref target="RFC7231"></xref> as "reserved for future use". Using HTTP-Payment a service MAY respond to any request with the 402 response code and use the "Pay" header to specify the payment request details.</t>

<section anchor="the-pay-header" title="The &quot;Pay&quot; Header">

<t>The body of the "Pay" header is defined as follows:</t>

<figure><artwork><![CDATA[
Pay: <payment-method-identifier> <amount> <address> <payment-method-data>
]]></artwork></figure>

<t>Multiple "Pay" headers MAY be present in an HTTP 402 response.</t>

<t>The fields in the header are:</t>

<t><list style="symbols">
  <t>payment-method:
The payment method identifier for the accepted payment method. Either a standardized short-string or a URL.</t>
  <t>amount:
The amount that must be paid, expressed as an integer. The currency, scale and precision of the destination account are expected to be expressed in the account address.</t>
  <t>address:
A payment-method specific payee address. For example, if the payment method is Bitcoin this would be a Bitcoin address.</t>
  <t>payment-method-data:
Payment method specific data. This is either a URI identifying the data or, if it is small enough, is the data itself, BASE64URL encoded as described in <xref target="RFC4648"></xref>, Section 5.</t>
</list></t>

</section>
<section anchor="the-pay-token-header" title="The &quot;Pay-Token&quot; Header">

<t>An HTTP client that makes a paid-HTTP request, after paying for the request to be processed, MAY attach a "Pay-Token" header with a token referencing the payment.</t>

<t>This mechanism can be employed by services wishing to accept payments without binding these to an HTTP session.</t>

</section>
<section anchor="the-pay-balance-header" title="The &quot;Pay-Balance&quot; Header">

<t>Ann HTTP Service that accepts payments may respond to any request with a "Pay-Balance" header. This contains an integer indicating the current balance of paid credit the client has with the HTTP service.</t>

</section>
<section anchor="flow" title="Flow">

<t>Upon receipt of a 402 response, an HTTP client MUST look for any "Pay" headers and parse these. The client can discard all headers for which it is not equipped to make a payment (i.e. filter on payment-method-identifier)</t>

<t>The client MUST then select the header that is preferred for processing based upon external interactions (such as with a human user) or pre-configured rules. The client MUST attempt to make a payment using the payment method identified in the header, for the amount specified, and to the destination address specified.</t>

<t>The payment-method specific data SHOULD be sufficient for the system processing the payment to reconcile the payment with the original HTTP request.</t>

<t>The client SHOULD receive a token in return for completeing the payment. If the payment method used does return a token to the payer, it MUST pass this token in subsequent HTTP requests.</t>

<t>The token MUST be passed in the "Pay-Token" header, BASE64URL encoded as described in <xref target="RFC4648"></xref>, Section 5.</t>

<t>The HTTP service MUST process the "Pay-Token" header and use this to reconcile this HTTP request with the payment received prior.</t>

</section>
<section anchor="example" title="Example">

<t>Client requests access to a paid resource:</t>

<figure><artwork><![CDATA[
POST /upload HTTP/1.1
Host: myservice.example
]]></artwork></figure>

<t>Server responds with payment request (and optionally indicates that the client has a zero balance):</t>

<figure><artwork><![CDATA[
HTTP/1.1 402 Payment Required
Pay: http://interledger.org 10 us.nexus.ankita.~recv.filepay SkTcFTZCBKgP6A6QOUVcwWCCgYIP4rJPHlIzreavHdU
Pay-Balance: 0
]]></artwork></figure>

<t>Client makes the payment through an appropriate payment side-channel and then attempts the request again:</t>

<figure><artwork><![CDATA[
POST /upload HTTP/1.1
Host: myservice.example
Pay-Token: 7y0SfeN7lCuq0GFF5UsMYZofIjJ7LrvPvsePVWSv450
]]></artwork></figure>

<t>Server responds:</t>

<figure><artwork><![CDATA[
HTTP/1.1 200 Success
Pay-Balance: 0  
]]></artwork></figure>

</section>
</section>


  </middle>

  <back>

    <references title='Normative References'>

&RFC4648;
&RFC7231;
&W3C.CR-payment-request-20170921;
&W3C.CR-payment-method-id-20170914;


    </references>

    <references title='Informative References'>

<reference anchor="HTTP-ILP" target="https://github.com/interledger/rfcs/blob/58d8dcb015b160a381313126fa3065c64406db05/0014-http-ilp/0014-http-ilp.md">
  <front>
    <title>HTTP-ILP</title>
    <author >
      <organization>Interledger Community Group</organization>
    </author>
    <date year="2017" month="October"/>
  </front>
</reference>


    </references>


<section anchor="security-considerations" title="Security Considerations">

<t>TBD</t>

</section>
<section anchor="iana-considerations" title="IANA Considerations">

<section anchor="payment-method-identifier-short-string-registry" title="Payment Method Identifier Short-string Registry">

<t>The W3C maintains a registry of standardized short-string payment method identifiers as part of the [Payment Method Identifier] specification. If standardized short-string identifiers are to be used for HTTP-Payments this may be better served as an IANA registry.</t>

</section>
</section>


  </back>

<!-- ##markdown-source:
H4sIAPSx91kAA61Z71Mbtxb9vn+FhnyBGdvYCZDU0+k8QkKghUAxNNMyTEe7
K9sq69VW2oU4H97f/s69ktZrA828N480ZH9opatz7z33XLXf7yeZyXU5G4um
nvbfJUmt60KNxcn19WX/Ui4XqqxdkpuslAs8zq2c1v25qVQ/lbrQqj+v66pf
hYH94TDJZK1mxi7HwtV5klR6LG5rk/WEM7a2aupwtVz4i8ws+Lu7xC2krf/8
uzG1cmNhptMkkVZJrKhdJetsnsimnhs7ThIh+vgrhC4x8nAgTsia92wNP/eW
HuZWy/LJS2Ox1StdVYW/dzBJ1WPxZrQvzk1Zz8xC2aWY8GMekekae5lgrmMr
y0y7zPBzq2balGNxdOiHmRyr/rA3Gu6F+6asCYWbCd9Xc1NiQH/zh1+qBSwc
C8k2/8uyeQOAwy8bCwgJZjfe3X18fBx03ielsQtZ6wc15rFXx0d7B3vv2pu3
r9+M/M2XN0eDo6voqb5VfzfK1f3Xw9Hb4Q+vnx+0UIA87+s8DBvtAX5dTtfX
5FA5Pbv0d/QTYmgrvtlavZF2RnDH7cx0PW9S2squLmtlC5XPlN2108ztpoVJ
d/ff5e/yLB2O9tPRwVC+eTd6gz+vD6byzfBgPzvY2xse5Olwf3c4HO35YNRF
tX43WOStATGKROcHMSFL/Q1bIn+eruwQR4jPpkQAiE/WNFX7VY4YHwsCpT8a
JgncKEpE7p/HSuWpzO6T5HqunXCVyvRUZzyzwAMEkZK2WAr1tVJWE8gIY5Fa
ZCD+E/VciUdj75EAfA1/iC8qFTER+SUNnJE5ojY8imAWlTXIMlMMxGlNSyGi
yhp/VS5kLW6fAdxHG+WyT+XdtVS+2/6vP9kZCNp42AJsQIZW2sKCdBmelWxw
F+KshRgQ3caIudt+FS93PL4yRarKrE6SNWoSuXKZ1akCuGKhsjk86RYCISoq
6RxhJZHkssylzfU32BKsFSEDok1zJXNlHSFPtEGQ7g1fY5SrTOkUHuY8jjyX
1bQnNZcP2jSWPuHxGRAhk+q5pOkzhRQRrsnmMCHOM/C7Weg8BwMlrwgLa/Im
oxDx6H3H6XNJm556z/qBhawpJ8Xh5alfHNinij551LlCuOWqKswSHyBiUmse
He2UMAogeJgCMgNBVtyG5a8CTJgbTvkOi+z0gmkc6pzRU5kpXkqKR5U6XSsy
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
hCGpqqlAh37VNxiM4KqZ/w9WR8cggB0AAA==

-->

</rfc>

